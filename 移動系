-- 最終まとめ版 強化ハブ | パス: jsokkzwa | Flyメンテ中
local pass = "jsokkzwa"

local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- パスワード入力GUI
local sg = Instance.new("ScreenGui")
sg.Parent = game:GetService("CoreGui")
sg.ResetOnSpawn = false

local tb = Instance.new("TextBox")
tb.Parent = sg
tb.Size = UDim2.new(0, 300, 0, 60)
tb.Position = UDim2.new(0.5, -150, 0.5, -30)
tb.PlaceholderText = "パスワード入力 (ヒント: jsokkzwa)"
tb.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
tb.TextColor3 = Color3.new(1, 1, 1)
tb.Font = Enum.Font.GothamBold
tb.TextSize = 24
tb.ClearTextOnFocus = false
tb.BorderSizePixel = 2
tb.BackgroundTransparency = 0.1

local auth = false
tb.FocusLost:Connect(function(enterPressed)
    if enterPressed and tb.Text == pass then
        sg:Destroy()
        auth = true
        
        -- 起動通知
        game.StarterGui:SetCore("SendNotification", {
            Title = "強化ハブ起動！";
            Text = "Speed 200 + 無限ジャンプ常時ON\nC = Noclipトグル | F = Discordコピー\nE = Fly状態確認（現在メンテ中）";
            Duration = 10
        })
    end
end)

repeat task.wait() until auth

-- 接続を管理するためのテーブル
local Connections = {}

local function clearConnections()
    for _, conn in pairs(Connections) do
        if conn.Connected then
            conn:Disconnect()
        end
    end
    table.clear(Connections)
end

local function applyToCharacter(char)
    if not char then return end
    
    clearConnections()  -- 前のキャラクターの接続を全解除
    
    local hum = char:WaitForChild("Humanoid")
    local root = char:WaitForChild("HumanoidRootPart")
    
    -- 基本強化
    hum.WalkSpeed = 200
    hum.JumpPower = 150
    
    -- 無限ジャンプ（1回だけ接続）
    table.insert(Connections, UIS.JumpRequest:Connect(function()
        if hum.Health > 0 then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end))
    
    -- キー入力処理
    table.insert(Connections, UIS.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == Enum.KeyCode.C then
            -- Noclip トグル
            local noclipConn = root:FindFirstChild("NoclipConnection")
            local enabled = not noclipConn
            
            if enabled then
                local conn = RunService.Stepped:Connect(function()
                    for _, part in pairs(char:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end)
                conn.Name = "NoclipConnection"
                conn.Parent = root
            else
                if noclipConn then
                    noclipConn:Disconnect()
                    noclipConn:Destroy()
                end
            end
            
            game.StarterGui:SetCore("SendNotification", {
                Title = "Noclip";
                Text = enabled and "ON" or "OFF";
                Duration = 2
            })
            
        elseif input.KeyCode == Enum.KeyCode.F then
            -- Discordリンクコピー
            setclipboard("https://discord.gg/Ax9yJDR6sV")
            game.StarterGui:SetCore("SendNotification", {
                Title = "Discord";
                Text = "招待リンクをクリップボードにコピーしました！";
                Duration = 3
            })
            
        elseif input.KeyCode == Enum.KeyCode.E then
            -- Flyメンテナンス中のお知らせ
            game.StarterGui:SetCore("SendNotification", {
                Title = "お知らせ";
                Text = "Fly機能は現在メンテナンス中です";
                Duration = 3
            })
        end
    end))
end

-- 初回キャラクター適用
if player.Character then
    applyToCharacter(player.Character)
end

-- キャラクターがリスポーンしたとき
player.CharacterAdded:Connect(applyToCharacter)

-- キャラクターが削除されたとき（念のためクリーンアップ）
player.CharacterRemoving:Connect(clearConnections)
